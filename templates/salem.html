<!DOCTYPE html>
<html ng-app="salemApp">
<head>
	<title>Salem</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/salem.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
	<script type="text/javascript" src="{{ url_for('static', filename='js/angular.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='js/angular-sanitize.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='js/salemApp.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='js/filters.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='js/services.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='js/directives.js') }}"></script>
</head>
<body>
	<div class="panel-group">
		<div ng-controller="personasCtrl" class="panel">
			<div class="panel--button-row">
				<div ng-class="'panel--button ' +
					'panel--button__triple ' +
					'panel--button__' +
					(val == data.selectedTeam ? 'pressed salem-text--' + val.toLowerCase() : 'unpressed')"
					ng-repeat="val in data.teamValues"
					ng-click="updateSelectedTeam(val)">
					{[val]}
				</div>
			</div>
			<div class="panel--button-row">
				<div ng-class="'panel--button ' +
					'panel--button__double ' +
					'panel--button__' +
					(val == data.selectedSpecificity ? 'pressed' : 'unpressed')"
					ng-repeat="val in data.specificityValues"
					ng-click="updateSelectedSpecificity(val)">
					{[val]}
				</div>
			</div>
			<div ng-if="data.personasLoading"
				class="panel--button panel--button__single
					fa fa-spinner fa-spin fa-3x">
			</div>
			<p ng-if="data.personasError">
				Failed to retrieve data. Try refreshing the page, or failing that, rolling on the floor	and crying.
			</p>
			<ul class="persona-list"
				ng-if="data.personas">
				<li ng-repeat="persona in data.personas.values()|iterToArray|specOnly:data.selectedSpecificity|teamOnly:data.selectedTeam">
					<p ng-bind-html='persona.name|salemifyText'></p>
					<button ng-if="showAddToCustomButton"
						ng-click="addToCustom(persona)">
						Add to Custom Game
					</button>
				</li>
			</ul>
		</div>
		<div ng-controller="populationCtrl" id="game-mode-panel" class="panel">
			<div ng-if="data.populationsLoading"
				class="panel--button panel--button__single
					fa fa-spinner fa-spin fa-3x">
			</div>
			<p ng-if="data.populationsError">
				Failed to retrieve data. Try refreshing the page, or failing that, rolling on the floor	and crying.
			</p>
			<div ng-if="data.populations">
				<select name=populationSelector ng-model="data.selectedMode"
					ng-options="mode for mode in data.populations.keys()|iterToArray"
					ng-disabled="editModeOn"
					class="panel--button panel--button__single">
					<option disabled="true" value="">-- Select Game Mode --</option>
				</select>
				<button class="panel--button panel--button__single"
					ng-show="data.selectedMode == 'Custom'"
					jpl-toggle toggle-state="editModeOn"
					toggle-action="broadcastEditMode(editModeOn)"
					off-text="Edit Population" on-text="Done Editing">
				</button>
				<ul class="persona-list">
					<li ng-repeat="persona in data.populations.get(data.selectedMode) track by $index + persona.name">
						<p ng-bind-html='persona.name|salemifyText'></p>
						<button ng-if="editModeOn" ng-click="removeFromCustom($index)">Remove</button>
					</li>
				</ul>
			</div>
		</div>
		<div ng-controller="autopsyCtrl">
			<modal-block id="causes-of-death-selection"
				show="data.show" width="600px" height="60%">
				<h3>Select the cause(s) of {[data.victimName]}'s' death</h3>
				<button
					ng-if="data.causesOfDeath"
					ng-repeat="cause in data.causesOfDeath"
					ng-class="'fa fa-' + cause.iconName + ' ' +
						(isSelected(cause) ? data.getColor(cause) :
						'salem-text--executioner')"
					ng-click="toggleCause(cause)">
				</button>
				<button class="panel--button panel--button__single"
					ng-click="confirm()"
					ng-disabled="data.selectedCauses.length == 0">
					He's dead, Jim! (Confirm)
				</button>
				<button class="panel--button panel--button__single"
					ng-click="close()">
					He got better! (Cancel)
				</button>
			</modal-block>
		</div>
		<div ng-controller="playerRosterCtrl" id="player-roster" class="panel">
			<h2 class="panel--header">Player List</h2>
			<button class="panel--button panel--button__single"
				jpl-toggle toggle-state="editAllNamesMode"
				off-text="Edit All Names" on-text="Done Editing">
			</button>
			<ul class="player-list">
				<li ng-repeat="player in data.playerRoster">
					<button ng-click='playerKilled(player)'
						ng-disabled='!player.alive'>
						Killed
					</button>
					<button ng-click='playerAccused(player)'
						ng-disabled='!player.alive'>
						Accused
					</button>
					<span ng-class="player.alive ? 'player-list-number' : 'player-list-number__dead'">
						{[(player.number)|padNumberText:2]}
					</span>
					<span
						ng-class="player.alive ? 'player-name' : 'player-name__dead'"
						ng-hide="editAllNamesMode">
						{[player.name]}
					</span>
					<input type="text"
						ng-if="$first"
						ng-show="editAllNamesMode"
						ng-model="player.name"
						jpl-focus focus-watch-property="editAllNamesMode" focus-select="true">
					</input>
					<input type="text"
						ng-if="!$first"
						ng-show="editAllNamesMode"
						ng-model="player.name">
					</input>
				</li>
			</ul>
			<h2 class="panel--header">Graveyard</h2>
			<ul class="player-list">
				<li ng-repeat="player in data.graveyard">
					<button class="fa fa-refresh"
						ng-click="playerRevived(player)">
					</button>
					<span class="player-list-number">
						{[player.number|padNumberText:2]}
					</span>
					<span class="player-name">{[player.name]}</span>
				</li>
			</ul>
		</div>
		<div ng-controller="accusationCtrl">
			<modal-block id="accusationPanel"
				show="data.show" width="600px" height="80%">
				<h3>{[data.accused.name]} has some explaining to do...</h3>
				<div ng-repeat="player in data.players">
					<button
						class="vote-button"
						ng-click="toggleVote(player)""
						ng-class="isVoting(player) ? 'vote-button--accusing' : ''">
						Accusing
					</button>
					<span class="player-list-number">
						{[(player.number)|padNumberText:2]}
					</span>
					<span class="player-name">
						{[player.name]}
					</span>
				</div>
				<button class="panel--button panel--button__single"
					ng-click="confirmAndLogVotes()">
					Confirm (Log Votes)
				</button>
				<button class="panel--button panel--button__single"
					ng-click="confirmAndSkipVotes()">
					Confirm (Skip Votes)
				</button>
				<button class="panel--button panel--button__single"
					ng-click="close()">
					Cancel
				</button>
			</modal-block>
		</div>
		<div ng-controller="trialCtrl">
			<modal-block id="trialPanel"
				show="data.show" width="600px" height="80%"
				no-hide="true">
				<h3>{[data.accused.name]} has been tried and judged.</h3>
				<div ng-repeat="player in data.jury.players">
					<button
						ng-repeat="choice in data.choices"
						ng-click="data.jury.setVote(player, choice)"
						class="vote-button"
						ng-class="data.jury.checkVote(player) == choice ? ('vote-button--selected salem-text--' + choice) : ''">
						{[choice]}
					</button>
					<span class="player-list-number">
						{[(player.number)|padNumberText:2]}
					</span>
					<span class="player-name">
						{[player.name]}
					</span>
				</div>
				<button class="panel--button panel--button__single"
					ng-click="confirmAndLogVotes()">
					Confirm (Log Votes)
				</button>
				<button class="panel--button panel--button__single"
					ng-click="confirmAndSkipVotes('innocent')">
					Innocent (Skip Votes)
				</button>
				<button class="panel--button panel--button__single"
					ng-click="confirmAndSkipVotes('guilty')">
					Guilty (Skip Votes)
				</button>
			</modal-block>
		</div>
		<div ng-controller="salemClockCtrl" class="panel">
			<h2 class="panel--header">Salem Clock</h2>
			<div class="clock-control">
				<button ng-click="data.clock.recede()">Fall Back</button>
				<p>{[data.clock.toString()]}</p>
				<button ng-click="data.clock.advance()">Spring Forward</button>
			</div>
		</div>
		<div ng-controller="gameEventLogCtrl" class="panel">
			<h2 class="panel--header">Game Event Log</h2>
			<ul class="event-log">
				<li ng-repeat="event in data.events">
					<game-event></game-event>
				</li>
			</ul>
		</div>
	</div>
</body>
</html>

